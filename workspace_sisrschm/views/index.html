
  
  
  
  
  
  <!DOCTYPE html>
<!-- ***************************************************************
*    Diese Datei gehört zum  WebEng-Kurs an der HNU
*    Copyright (c) by Projektgruppe 6                     
*    Licensed under GPL3, see http://www.gnu.org/licenses/gpl.html
******************************************************************** -->
<html>

<head>
    <title>Homepage</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="stylesheets/css-style.css">



    <script type="text/javascript" src="client-js/jquery-3.5.1.min.js"></script>

    <!-- Einbindung von VALIDATE -->
    <script type="text/javascript" src="client-js/jquery.validate.min.js"></script>


    <!-- Einbindung von JQuery UI -->
    <script src="client-js/jquery-ui-1.12.1/jquery-ui.js"></script>
<!-- Einbindung von extensions-->
    <script type="text/javascript" src="client-js/jquery-extensions.js"></script>

    <link rel="stylesheet" href="client-js/jquery-ui-1.12.1/jquery-ui.css">

</head>




<body>
    <div id="leererBlock"></div>



    <header>
        <nav class="navigation">

            <a href="index.html"> <img id="logo" src="pics/logo_StrongHeart.png" /> </a>
            <ul>

                <li><a href="Waren-dyn.html">Shop</a></li>
                <li><a href="aktionen.html">Aktionen</a></li>
                <li><a href="teammitglieder.html">Teammitglieder</a></li>
                <li><a href="partner-dyn-modell.html">Partner</a></li>
                <li><a href="Kontaktanfragen.html">Kontaktanfragen</a></li>
                <li><a href="coaches.html">Coaches Anmeldungen</a></li>
                <li><a href="umbau.html">Showcase Videos</a></li>
                <li>
                    <button id="logKnopf">Einloggen</button>
                </li>
            </ul>

        </nav>

    </header>





    <br />

    <div id="main">



        <!-- Homepage-Inhalt -->
        <div id="homepage" class="view">



            <img id="homepagebild" src="pics/Hintergrundohnelogo.png" />

            <div class="text">
                <h1> MAKE YOUR</h1>
                <h1> HEART BEAT</h1>
                <h1>STRONGER </h1>
                <a href="Waren-dyn.html"> <img class="buyButton" src="pics/buttonHome.png" /> </a>
            </div>



        </div>



        <!-- LOGINMASKE -->

        <div id="loginMaske" class="view">
            <div class="platzhalter"></div>
            <h2 class="ueberschrift">Logge dich ein!</h2>
            <form action="javascript:einloggen()" method="post">

                <table>
                    <tr>
                        <div class="formular1">
                            <td> <label>Benutzername</label></td>
                            <td> <input  id="user" type="text" placeholder="Benutzernamen eingeben" /> </td>
                        </div>
                    </tr>
                    <tr>
                        <div class="formular">
                            <td> <label>Passwort</label> </td>
                            <td> <input id="passwort" type="password" placeholder="Passwort eingeben" /> </td>
                        </div>
                    </tr>
                    <tr>
                       
                    </tr>
                    <tr>
                        <td></td>
                        <td> <input type="submit" value="Login" /></td>
                    </tr>
                </table>
            </form>

        </div>





    </div>





    <script type="text/javascript">
        //ANZEIGEN
        function homepageAnzeigen() {
            console.log('homepageAnzeigen: ');
            $(".view").hide();
            $("#homepage").show();
        }



        /*  //nur Homepage sichtbar machen
         */
        $(".view").hide();
        $("#homepage").show();
        /*
                  
                   

                        
              */
        // ********* FUNKTIONEN ZUM LOGIN UND LOGOUT **********
     function checkeBerechtigungen() {
           console.log("Funktion checkeBerechtigungen")
            //Alle Knöpfe auf unsichtbar setzen
            $('.adminButton, .maButton').hide();
	        leseRolle(callback);
			  function callback(roles){
					console.log("Funktion callback mit " + JSON.stringify(roles).toString());
					var rolesArray=roles.toString().split(',');
					for (var i = 0; i < rolesArray.length; i++) {
						if (rolesArray[i] == 'admin') {
							console.log("\t admin-Button wird gezeigt");
							$('.adminButton').show();
						} else if (rolesArray[i] == 'mitarbeiter') {
							console.log('\t mitarbeiter-Button wird gezeigt');
							$('.maButton').show();
              
            /*** Teammitglied und aushilfe wurden als Rollen hinzugefügt **/
						}else if (rolesArray[i] == 'teammitglied') {
							console.log('\t Teammitgliedansicht wird gezeigt');
						
						}else if (rolesArray[i] == 'aushilfe') {
							console.log('\t n wird gezeigt');
						
						} else {
							console.log("\t Unbekannte Rolle: " + rolesArray[i]);
             
						}           
					}
				console.log("Achtung Achtung")
				}
        
        }

        function leseRolle(func) {
             console.log("Funktion leseRolle");
             //Beim Server wird nachgefragt, ob der Benutzer eingeloggt ist
             $.get("/service_istEingelogged", function(data) {
               console.log("eingeloggt: " + data.toString());

                //Falls User eingeloggt ist, dann werden Sichtbarkeiten in Abhängigkeit von den Rollen gesetzt
                if (data === true) {
						 //Benutzer ist eingeloggt
                   console.log("\t eingeloggt");
						 setLoginButton("ausloggen");
                   //Berechtigungen werden erfragt und bei erfolgreichem Lesen wird whatToDo ausgeführt
                   $.get("/service_rollenAbfrage", function(roles){
                      func(roles);
                   })} 
                 else {
                   //Benutzer ist nicht eingeloggt
                   console.log("\t nicht eingeloggt");
						 setLogoutButton("zeigeLoginmaske");
                   
            
                 }
            })
        }


        function einloggen(){
            console.log("Funktion einloggen");           
            
            //Einloggen
            var loginDaten = {"user": $("#user").val(),
                              "password": $("#passwort").val()
            }
            $.post('/login', loginDaten, function(data) {
                if (data === false) {
			         console.log("\t POST: falscher login");
                     alert("Ihre Benutzerdaten waren nicht richtig, bitte versuchen Sie es noch einmal.");
                }
                else {
			         console.log("\t POST: richtiger login");
                  
            		//Richtige Ansicht nach dem Einloggen anzeigen
              homepageAnzeigen();
              checkeBerechtigungen();
                }
            })
            
        }

  
      function ausloggen(){
            console.log("Funktion ausloggen");
            //Ausloggen
             $.get('/logout', function(res) {
                console.log("\t GET: logout success");
					 //Berechtigungen anpassen
               checkeBerechtigungen();
               //Loggen-Knopf setzen
               setLogoutButton('zeigeLoginmaske');
               //Richtige Ansicht nach dem Ausloggen anzeigen
                 homepageAnzeigen();
             })
        	  .fail(function(xhr){
                console.log("\t GET: logout failure");
           	    //xhr steht für XML-HTTP-Request, also das HTTP-Objekt
           	    console.log("/t Aufruf von get.fail-Funktion mit Parameter err=" + xhr.responseText);
           	    errorAlert(xhr.responseText);
            });
            
        }

        function setLoginButton(func) {
            console.log("Funktion setLoginButton mit " + func)
            //Loggen-Knopf zu Logout-Knopf machen
            $("#logKnopf").html("Ausloggen")
                .attr("onclick", func + "()");
        }

        function setLogoutButton(func) {
            console.log("Funktion setLogoutButton mit " + func)
            //Loggen-Knopf zu Login-Knopf machen
            $("#logKnopf").html("Einloggen")
                .attr("onclick", func + "()");
        }

        function zeigeLoginmaske() {
            console.log('zeigeLoginmaske');
            //nur Loginansicht sichtbar machen
            $(".view").hide();
            $("#loginMaske").show();
        }

  function errorAlert(data) {
   			console.log("Server Error Message: " + JSON.stringify(data).toString());
   			alert("Fehler auf dem Server: " + JSON.stringify(data).toString());
		  }

        homepageAnzeigen();
        ausloggen();

    </script>


    <div>
        <footer>

            <nav>

                <ul>
                    <li><a href="umbau.html">Impressum</a></li>
                    <li><a href="umbau.html">Datenschutz</a></li>
                    <li><a href="umbau.html">Cookie-Einstellungen</a></li>
                    <li><a href="umbau.html">Widerrufsbelehrung</a></li>
                    <li><a href="umbau.html">AGB</a></li>


                </ul>

            </nav>

        </footer>
    </div>

</body>

</html>
